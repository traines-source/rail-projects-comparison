/*! https://github.com/traines-source/transport-network-animator MIT License. For vendor licenses, please see network-animator.LICENSES.json */(()=>{var t={2531:(t,e,i)=>{var n=i(9839);i(7672).TNA=n,t.exports=n},8199:(t,e,i)=>{var n=i(2957);i(7672).TNA=n,t.exports=n},19:(t,e,i)=>{var n=i(3191);i(7672).TNA=n,t.exports=n},1312:(t,e,i)=>{var n=i(1148);i(7672).TNA=n,t.exports=n},2358:(t,e,i)=>{var n=i(7197);i(7672).TNA=n,t.exports=n},6668:(t,e,i)=>{var n=i(9492);i(7672).TNA=n,t.exports=n},1238:(t,e,i)=>{var n=i(775);i(7672).TNA=n,t.exports=n},8856:(t,e,i)=>{var n=i(6630);i(7672).TNA=n,t.exports=n},4073:(t,e,i)=>{var n=i(7756);i(7672).TNA=n,t.exports=n},9499:(t,e,i)=>{var n=i(7642);i(7672).TNA=n,t.exports=n},900:(t,e,i)=>{var n=i(5802);i(7672).TNA=n,t.exports=n},9591:(t,e,i)=>{var n=i(9059);i(7672).TNA=n,t.exports=n},5936:(t,e,i)=>{var n=i(4338);i(7672).TNA=n,t.exports=n},7858:(t,e,i)=>{var n=i(8119);i(7672).TNA=n,t.exports=n},7723:(t,e,i)=>{var n=i(4740);i(7672).TNA=n,t.exports=n},9732:(t,e,i)=>{var n=i(8860);i(7672).TNA=n,t.exports=n},9293:(t,e,i)=>{var n=i(4394);i(7672).TNA=n,t.exports=n},5635:(t,e,i)=>{var n=i(6335);i(7672).TNA=n,t.exports=n},5656:(t,e,i)=>{var n=i(3540);i(7672).TNA=n,t.exports=n},6311:(t,e,i)=>{var n=i(7968);i(7672).TNA=n,t.exports=n},5400:(t,e,i)=>{var n=i(95);i(7672).TNA=n,t.exports=n},294:(t,e,i)=>{var n=i(8869);i(7672).TNA=n,t.exports=n},1761:(t,e,i)=>{var n=i(8999);i(7672).TNA=n,t.exports=n},7014:(t,e,i)=>{var n=i(2632);i(7672).TNA=n,t.exports=n},6844:(t,e,i)=>{var n=i(8537);i(7672).TNA=n,t.exports=n},71:(t,e,i)=>{var n=i(5836);i(7672).TNA=n,t.exports=n},1449:(t,e,i)=>{var n=i(3966);i(7672).TNA=n,t.exports=n},8497:(t,e,i)=>{var n=i(7862);i(7672).TNA=n,t.exports=n},1295:(t,e,i)=>{var n=i(6823);i(7672).TNA=n,t.exports=n},3737:(t,e,i)=>{var n=i(8859);i(7672).TNA=n,t.exports=n},2203:(t,e,i)=>{var n=i(2565);i(7672).TNA=n,t.exports=n},3721:(t,e,i)=>{var n=i(2234);i(7672).TNA=n,t.exports=n},3197:(t,e,i)=>{var n=i(3351);i(7672).TNA=n,t.exports=n},4183:(t,e,i)=>{var n=i(4536);i(7672).TNA=n,t.exports=n},300:(t,e,i)=>{var n=i(490);i(7672).TNA=n,t.exports=n},7672:(t,e,i)=>{"use strict";t.exports=function(){if("object"==typeof globalThis)return globalThis;var t;try{t=this||new Function("return this")()}catch(t){if("object"==typeof window)return window;if("object"==typeof self)return self;if(void 0!==i.g)return i.g}return t}()},9916:function(t,e){!function(t){"use strict";function e(t,e,i,n){var s=(n=n||{}).maxIterations||100,r=n.tolerance||1e-10,a=t(e),o=t(i),l=i-e;if(a*o>0)throw"Initial bisect points must have opposite signs";if(0===a)return e;if(0===o)return i;for(var h=0;h<s;++h){var d=e+(l/=2),c=t(d);if(c*a>=0&&(e=d),Math.abs(l)<r||0===c)return d}return e+l}function i(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=0;return e}function n(t,e){return i(t).map((function(){return i(e)}))}function s(t,e){for(var i=0,n=0;n<t.length;++n)i+=t[n]*e[n];return i}function r(t){return Math.sqrt(s(t,t))}function a(t,e,i){for(var n=0;n<e.length;++n)t[n]=e[n]*i}function o(t,e,i,n,s){for(var r=0;r<t.length;++r)t[r]=e*i[r]+n*s[r]}function l(t,e,i){var n,s=(i=i||{}).maxIterations||200*e.length,r=i.nonZeroDelta||1.05,a=i.zeroDelta||.001,l=i.minErrorDelta||1e-6,h=i.minErrorDelta||1e-5,d=void 0!==i.rho?i.rho:1,c=void 0!==i.chi?i.chi:2,u=void 0!==i.psi?i.psi:-.5,g=void 0!==i.sigma?i.sigma:.5,f=e.length,m=new Array(f+1);m[0]=e,m[0].fx=t(e),m[0].id=0;for(var p=0;p<f;++p){var x=e.slice();x[p]=x[p]?x[p]*r:a,m[p+1]=x,m[p+1].fx=t(x),m[p+1].id=p+1}function v(t){for(var e=0;e<t.length;e++)m[f][e]=t[e];m[f].fx=t.fx}for(var w=function(t,e){return t.fx-e.fx},b=e.slice(),y=e.slice(),S=e.slice(),_=e.slice(),I=0;I<s;++I){if(m.sort(w),i.history){var C=m.map((function(t){var e=t.slice();return e.fx=t.fx,e.id=t.id,e}));C.sort((function(t,e){return t.id-e.id})),i.history.push({x:m[0].slice(),fx:m[0].fx,simplex:C})}for(n=0,p=0;p<f;++p)n=Math.max(n,Math.abs(m[0][p]-m[1][p]));if(Math.abs(m[0].fx-m[f].fx)<l&&n<h)break;for(p=0;p<f;++p){b[p]=0;for(var B=0;B<f;++B)b[p]+=m[B][p];b[p]/=f}var A=m[f];if(o(y,1+d,b,-d,A),y.fx=t(y),y.fx<m[0].fx)o(_,1+c,b,-c,A),_.fx=t(_),_.fx<y.fx?v(_):v(y);else if(y.fx>=m[f-1].fx){var T=!1;if(y.fx>A.fx?(o(S,1+u,b,-u,A),S.fx=t(S),S.fx<A.fx?v(S):T=!0):(o(S,1-u*d,b,u*d,A),S.fx=t(S),S.fx<y.fx?v(S):T=!0),T){if(g>=1)break;for(p=1;p<m.length;++p)o(m[p],1-g,m[0],g,m[p]),m[p].fx=t(m[p])}}else v(y)}return m.sort(w),{fx:m[0].fx,x:m[0]}}function h(t,e,i,n,r,a,l){var h=i.fx,d=s(i.fxprime,e),c=h,u=h,g=d,f=0;function m(u,f,m){for(var p=0;p<16;++p)if(r=(u+f)/2,o(n.x,1,i.x,r,e),c=n.fx=t(n.x,n.fxprime),g=s(n.fxprime,e),c>h+a*r*d||c>=m)f=r;else{if(Math.abs(g)<=-l*d)return r;g*(f-u)>=0&&(f=u),u=r,m=c}return 0}r=r||1,a=a||1e-6,l=l||.1;for(var p=0;p<10;++p){if(o(n.x,1,i.x,r,e),c=n.fx=t(n.x,n.fxprime),g=s(n.fxprime,e),c>h+a*r*d||p&&c>=u)return m(f,r,u);if(Math.abs(g)<=-l*d)return r;if(g>=0)return m(r,f,c);u=c,f=r,r*=2}return r}function d(t,e,i){var n,l,d,c={x:e.slice(),fx:0,fxprime:e.slice()},u={x:e.slice(),fx:0,fxprime:e.slice()},g=e.slice(),f=1;d=(i=i||{}).maxIterations||20*e.length,c.fx=t(c.x,c.fxprime),a(n=c.fxprime.slice(),c.fxprime,-1);for(var m=0;m<d;++m){if(f=h(t,n,c,u,f),i.history&&i.history.push({x:c.x.slice(),fx:c.fx,fxprime:c.fxprime.slice(),alpha:f}),f){o(g,1,u.fxprime,-1,c.fxprime);var p=s(c.fxprime,c.fxprime);o(n,Math.max(0,s(g,u.fxprime)/p),n,-1,u.fxprime),l=c,c=u,u=l}else a(n,c.fxprime,-1);if(r(c.fxprime)<=1e-5)break}return i.history&&i.history.push({x:c.x.slice(),fx:c.fx,fxprime:c.fxprime.slice(),alpha:f}),c}function c(t,e,i){for(var n=(i=i||{}).maxIterations||100*e.length,s=i.learnRate||.001,a={x:e.slice(),fx:0,fxprime:e.slice()},l=0;l<n&&(a.fx=t(a.x,a.fxprime),i.history&&i.history.push({x:a.x.slice(),fx:a.fx,fxprime:a.fxprime.slice()}),o(a.x,1,a.x,-s,a.fxprime),!(r(a.fxprime)<=1e-5));++l);return a}function u(t,e,i){i=i||{};var n,s={x:e.slice(),fx:0,fxprime:e.slice()},o={x:e.slice(),fx:0,fxprime:e.slice()},l=i.maxIterations||100*e.length,d=i.learnRate||1,c=e.slice(),u=i.c1||.001,g=i.c2||.1,f=[];if(i.history){var m=t;t=function(t,e){return f.push(t.slice()),m(t,e)}}s.fx=t(s.x,s.fxprime);for(var p=0;p<l&&(a(c,s.fxprime,-1),d=h(t,c,s,o,d,u,g),i.history&&(i.history.push({x:s.x.slice(),fx:s.fx,fxprime:s.fxprime.slice(),functionCalls:f,learnRate:d,alpha:d}),f=[]),n=s,s=o,o=n,!(0===d||r(s.fxprime)<1e-5));++p);return s}t.bisect=e,t.nelderMead=l,t.conjugateGradient=d,t.gradientDescent=c,t.gradientDescentLineSearch=u,t.zeros=i,t.zerosM=n,t.norm2=r,t.weightedSum=o,t.scale=a}(e)},9839:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Animator=void 0;class i{constructor(){this._from=0,this._to=1,this._timePassed=0,this._ease=i.EASE_NONE,this.callback=t=>!0,this.startTime=0,this.durationMilliseconds=0}from(t){return this._from=t,this}to(t){return this._to=t,this}timePassed(t){return this._timePassed=t,this}ease(t){return this._ease=t,this}wait(t,e){t>0?this.timeout(e,t):e()}animate(t,e){this.durationMilliseconds=t,this.callback=e,this.startTime=this.now(),this.frame()}frame(){const t=this.now();let e=1;this.durationMilliseconds>0&&(e=(t-this.startTime+this._timePassed)/this.durationMilliseconds),e=Math.max(0,Math.min(1,e));const i=this._from+(this._to-this._from)*this._ease(e),n=this.callback(i,1==e);n&&e<1?this.requestFrame((()=>this.frame())):n||console.log("Stopped animation because callback returned false.")}}e.Animator=i,i.EASE_NONE=t=>t,i.EASE_CUBIC=t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,i.EASE_SINE=t=>-(Math.cos(Math.PI*t)-1)/2},2957:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ArrivalDepartureTime=void 0;e.ArrivalDepartureTime=class{constructor(t){this.value=t}parse(t){const e=this.value.split(/([-+])/);return parseFloat(e[t])*("-"==e[t-1]?-1:1)}get departure(){return this.parse(2)}get arrival(){return this.parse(4)}}},3191:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BoundingBox=void 0;const n=i(7858);class s{constructor(t,e){this.tl=t,this.br=e}static from(t,e,i,r){return new s(new n.Vector(t,e),new n.Vector(i,r))}get dimensions(){return this.tl.delta(this.br)}isNull(){return this.tl==n.Vector.NULL||this.br==n.Vector.NULL}calculateBoundingBoxForZoom(t,e){const i=this.dimensions,r=new n.Vector(t/100,e/100),a=this.tl.add(new n.Vector(i.x*r.x,i.y*r.y)),o=new n.Vector(i.x*Math.min(r.x,1-r.x),i.y*Math.min(r.y,1-r.y)),l=new n.Vector(o.y*i.x/i.y,o.x*i.y/i.x),h=new n.Vector(Math.min(o.x,l.x),Math.min(o.y,l.y));return new s(a.add(new n.Vector(-h.x,-h.y)),a.add(h))}add(...t){for(let e=0;e<t.length;e++)this.tl=this.tl.bothAxisMins(t[e]),this.br=this.br.bothAxisMaxs(t[e])}}e.BoundingBox=s},1148:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Config=void 0;class i{constructor(){this.autoStart=!0,this.mapProjection="epsg3857",this.mapProjectionScale=1,this.zoomMaxScale=3,this.beckStyle=!0,this.minNodeDistance=0,this.animSpeed=100,this.fadeDurationSeconds=.2,this.lineDistance=6,this.defaultStationDimen=10,this.labelHeight=12,this.labelDistance=0,this.zoomDuration=1,this.zoomPaddingFactor=40,this.trainWagonLength=10,this.trainTrackOffset=0,this.trainTimetableSpeed=60,this.gravitatorInertness=.1,this.gravitatorUseInclinationInertness=!0,this.gravitatorGradientScale=.01,this.gravitatorInitializeRelativeToEuclidianDistance=!0,this.gravitatorAnimSpeed=250,this.gravitatorAnimMaxDurationSeconds=6,this.gravitatorColorDeviation=.02}static get default(){return this._default||(this._default=new i)}}e.Config=i},7197:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DrawableSorter=void 0;const n=i(5400),s=i(7858);e.DrawableSorter=class{constructor(){}sort(t,e,i){if(0==t.length)return[];const s=t[0];return s instanceof n.Line&&null!=s.animOrder?this.orderByGeometricDirection(t,s.animOrder,e,i):(e||t.reverse(),[])}buildSortableCache(t,e){const i=[];for(let r=0;r<t.length;r++)if(t[r]instanceof n.Line){const n=t[r];let a=[s.Vector.NULL,s.Vector.NULL];n.path.length>1&&(a=[n.path[0],n.path[n.path.length-1]]);const o=a[0].signedLengthProjectedAt(e),l=a[1].signedLengthProjectedAt(e),h=o<l;h&&a.reverse(),i.push({element:n,termini:a,projection:Math.max(o,l),reverse:h,animationDuration:n.animationDurationSeconds})}return i}orderByGeometricDirection(t,e,i,n){var s;const r=this.buildSortableCache(t,e);r.sort(((t,e)=>t.projection<e.projection?1:-1)),t.splice(0,t.length);const a=[];for(let o=0;o<r.length;o++){const l=r[o].termini[0];let h=l.delta(r[0].termini[0]).length,d=0,c=0;for(let t=0;t<o;t++)for(let i=0;i<2;i++){const n=l.delta(r[t].termini[i]),s=n.length;s<=h&&(h=s,d=n.signedLengthProjectedAt(e),c=a[t].delay+(1==i?r[t].animationDuration:0))}const u=!n||(null===(s=r[o].element[i?"from":"to"])||void 0===s?void 0:s.flag.includes("noanim"))?0:c+d/r[o].element.speed;a.push({delay:u,reverse:r[o].reverse==i}),t.push(r[o].element)}return a}}},9492:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Gravitator=void 0;const n=i(7858),s=i(5936),r=i(1312),a=i(9293),o=i(9916);class l{constructor(){this.initialWeightFactors={},this.averageEuclidianLengthRatio=-1,this.averageEuclidianLength=1,this.edges={},this.vertices={},this.dirty=!1}gravitate(t,e){if(!this.dirty)return t;this.dirty=!1,this.initialize(),this.initializeGraph();const i=this.minimizeLoss();return this.assertDistances(i),this.moveStationsAndLines(i,t,e)}initialize(){var t;const e=this.getWeightsSum(),i=this.getEuclidianDistanceSum(),n=Object.values(this.edges).length;-1==this.averageEuclidianLengthRatio&&n>0&&(this.averageEuclidianLengthRatio=e/i,this.averageEuclidianLength=i/n,null===(t=this.crumpledImage)||void 0===t||t.initialize(Object.values(this.vertices).map((t=>t.station))))}getWeightsSum(){let t=0;for(const e of Object.values(this.edges))t+=e.line.weight||0;return t}getEuclidianDistanceSum(){let t=0;for(const e of Object.values(this.edges))t+=this.edgeVector(e).length;return t}edgeVector(t){return this.vertices[t.line.termini[1].stationId].station.baseCoords.delta(this.vertices[t.line.termini[0].stationId].station.baseCoords)}initializeGraph(){for(const[t,e]of Object.entries(this.edges))null==this.initialWeightFactors[t]&&(this.initialWeightFactors[t]=r.Config.default.gravitatorInitializeRelativeToEuclidianDistance?1/this.averageEuclidianLengthRatio:this.edgeVector(e).length/(e.line.weight||0));let t=0;for(const e of Object.values(this.vertices))e.index=new n.Vector(t,t+1),t+=2}minimizeLoss(){const t=this,e=this.startStationPositions();return o.conjugateGradient(((e,i)=>{i=i||e.slice();for(let t=0;t<i.length;t++)i[t]=0;let n=0;return r.Config.default.gravitatorUseInclinationInertness?n=t.deltaToInclinationToEnsureInertness(n,e,i):(n=t.deltaToStartStationPositionsToEnsureInertness(n,e,i),n=t.deltaToCurrentStationPositionsToEnsureInertness(n,e,i)),n=t.deltaToNewDistancesToEnsureAccuracy(n,e,i),t.scaleGradientToEnsureWorkingStepSize(i),n}),e,{history:[]}).x}startStationPositions(){const t=[];for(const e of Object.values(this.vertices))t[e.index.x]=e.startCoords.x,t[e.index.y]=e.startCoords.y;return t}deltaX(t,e,i){return t[e[i[0].stationId].index.x]-t[e[i[1].stationId].index.x]}deltaY(t,e,i){return t[e[i[0].stationId].index.y]-t[e[i[1].stationId].index.y]}deltaXStart(t,e){return t[e[0].stationId].startCoords.x-t[e[1].stationId].startCoords.x}deltaYStart(t,e){return t[e[0].stationId].startCoords.y-t[e[1].stationId].startCoords.y}deltaToStartStationPositionsToEnsureInertness(t,e,i){return this.deltaToPreviousStationPositionsToEnsureInertness(t,e,i,!0)}deltaToCurrentStationPositionsToEnsureInertness(t,e,i){return this.deltaToPreviousStationPositionsToEnsureInertness(t,e,i,!1)}deltaToPreviousStationPositionsToEnsureInertness(t,e,i,n){for(const s of Object.values(this.vertices)){const a=n?s.startCoords:s.station.baseCoords,o=1/Math.pow(this.averageEuclidianLength,2);t+=(Math.pow(e[s.index.x]-a.x,2)+Math.pow(e[s.index.y]-a.y,2))*o*r.Config.default.gravitatorInertness,i[s.index.x]+=2*(e[s.index.x]-a.x)*o*r.Config.default.gravitatorInertness,i[s.index.y]+=2*(e[s.index.y]-a.y)*o*r.Config.default.gravitatorInertness}return t}deltaToInclinationToEnsureInertness(t,e,i){for(const[n,s]of Object.entries(this.edges)){const n=s.line,a=s.inclination.x,o=s.inclination.y,l=this.deltaX(e,this.vertices,n.termini),h=this.deltaY(e,this.vertices,n.termini),d=Math.pow(l,2)+Math.pow(h,2),c=1/Math.sqrt(d),u=l*c-a,g=h*c-o;t+=(Math.pow(u,2)+Math.pow(g,2))*r.Config.default.gravitatorInertness;const f=1,m=-1,p=0,x=0,v=0,w=0,b=1,y=-1,S=Math.pow(d,-1.5),_=-1*(l*f+h*v)*S,I=-1*(l*m+h*w)*S,C=-1*(l*p+h*b)*S,B=-1*(l*x+h*y)*S,A=f*c+l*_,T=m*c+l*I,L=p*c+l*C,D=x*c+l*B,M=v*c+h*_,N=w*c+h*I,P=b*c+h*C,E=y*c+h*B,V=2*r.Config.default.gravitatorInertness;i[this.vertices[n.termini[0].stationId].index.x]+=V*(u*A+g*M),i[this.vertices[n.termini[0].stationId].index.y]+=V*(u*L+g*P),i[this.vertices[n.termini[1].stationId].index.x]+=V*(u*T+g*N),i[this.vertices[n.termini[1].stationId].index.y]+=V*(u*D+g*E)}return t}deltaToNewDistancesToEnsureAccuracy(t,e,i){for(const[n,s]of Object.entries(this.edges)){const r=s.line,a=1,o=a/Math.pow(this.initialWeightFactors[n]*(r.weight||0),2),l=(Math.pow(this.deltaX(e,this.vertices,r.termini),2)+Math.pow(this.deltaY(e,this.vertices,r.termini),2))*o-a;t+=Math.pow(l,2),i[this.vertices[r.termini[0].stationId].index.x]+=4*l*o*this.deltaX(e,this.vertices,r.termini),i[this.vertices[r.termini[0].stationId].index.y]+=4*l*o*this.deltaY(e,this.vertices,r.termini),i[this.vertices[r.termini[1].stationId].index.x]+=-4*l*o*this.deltaX(e,this.vertices,r.termini),i[this.vertices[r.termini[1].stationId].index.y]+=-4*l*o*this.deltaY(e,this.vertices,r.termini)}return t}scaleGradientToEnsureWorkingStepSize(t){for(let e=0;e<t.length;e++)t[e]*=r.Config.default.gravitatorGradientScale}assertDistances(t){let e=0;for(const[i,n]of Object.entries(this.edges)){const s=n.line,r=Math.sqrt(Math.pow(this.deltaX(t,this.vertices,s.termini),2)+Math.pow(this.deltaY(t,this.vertices,s.termini),2))/(this.initialWeightFactors[i]*(s.weight||0))-1;e+=Math.abs(r),Math.abs(r)>l.DEVIATION_WARNING&&console.warn(s.name,"diverges by ",r)}console.log("Total relative deviation",e)}moveStationsAndLines(t,e,i){var s;const a=i?Math.min(r.Config.default.gravitatorAnimMaxDurationSeconds,this.getTotalDistanceToMove(t)/r.Config.default.gravitatorAnimSpeed):0;for(const i of Object.values(this.vertices))i.station.move(e,a,new n.Vector(t[i.index.x],t[i.index.y]));for(const i of Object.values(this.edges)){const n=i.line,s=[this.getNewStationPosition(n.termini[0].stationId,t),this.getNewStationPosition(n.termini[1].stationId,t)];n.move(e,a,s,this.getColorByDeviation(n,n.weight||0))}return null===(s=this.crumpledImage)||void 0===s||s.crumple(e,a),e+=a}getColorByDeviation(t,e){const i=this.vertices[t.termini[0].stationId].startCoords.delta(this.vertices[t.termini[1].stationId].startCoords).length;return Math.max(-1,Math.min(1,(e-this.averageEuclidianLengthRatio*i)*r.Config.default.gravitatorColorDeviation))}getTotalDistanceToMove(t){let e=0;for(const i of Object.values(this.vertices))e+=new n.Vector(t[i.index.x],t[i.index.y]).delta(i.station.baseCoords).length;return e}getNewStationPosition(t,e){return new n.Vector(e[this.vertices[t].index.x],e[this.vertices[t].index.y])}addVertex(t,e){if(null==this.vertices[t]){const i=e.stationById(t);if(null==i)throw new Error("Station with ID "+t+" is undefined");this.vertices[t]={station:i,index:n.Vector.NULL,startCoords:i.baseCoords}}}startEdgeInclination(t){const e=this.deltaXStart(this.vertices,t.termini),i=this.deltaYStart(this.vertices,t.termini),s=1/Math.sqrt(Math.pow(e,2)+Math.pow(i,2));return new n.Vector(e*s,i*s)}addEdge(t,e){if(null==t.weight)return;this.dirty=!0;const i=this.getIdentifier(t);this.addVertex(t.termini[0].stationId,e),this.addVertex(t.termini[1].stationId,e),this.edges[i]={line:t,inclination:this.startEdgeInclination(t)}}removeEdge(t){if(null==t.weight)return;this.dirty=!0;const e=this.getIdentifier(t);delete this.edges[e]}setIfCrumpledImage(t){t instanceof a.CrumpledImage&&(null!=this.crumpledImage&&console.warn("Currently, only one crumpled image at a time is supported. Replacing."),this.crumpledImage=t)}getIdentifier(t){return s.Utils.alphabeticId(t.termini[0].stationId,t.termini[1].stationId)}}e.Gravitator=l,l.DEVIATION_WARNING=.2},775:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Instant=void 0;class i{constructor(t,e,i){this._epoch=t,this._second=e,this._flag=i}get epoch(){return this._epoch}get second(){return this._second}get flag(){return this._flag}static from(t){var e;return new i(parseInt(t[0]),parseFloat(t[1]),null!==(e=t[2])&&void 0!==e?e:"")}equals(t){return this.epoch==t.epoch&&this.second==t.second}delta(t){return this.epoch==t.epoch?t.second-this.second:t.second}}e.Instant=i,i.BIG_BANG=new i(0,0,"")},6630:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LineGroup=void 0;const n=i(294),s=i(7858);e.LineGroup=class{constructor(){this._lines=[],this._termini=[],this.strokeColor=0}addLine(t){this._lines.includes(t)||this._lines.push(t),this.updateTermini()}removeLine(t){let e=0;for(;e<this._lines.length;)this._lines[e]==t?this._lines.splice(e,1):e++;this.updateTermini()}get termini(){return this._termini}getPathBetween(t,e){const i=this.getLinesWithStop(t),n=this.getLinesWithStop(e);if(0==i.length||0==n.length)return null;for(const t of Object.values(i))for(const e of Object.values(n))if(t.line==e.line)return this.getPathBetweenStops(t.line,t.stop,e.stop);for(const t of Object.values(i))for(const e of Object.values(n)){const i=this.findCommonStop(t.line,e.line);if(null!=i){const n=this.getPathBetweenStops(t.line,t.stop,i),s=this.getPathBetweenStops(e.line,i,e.stop),r=n.path.slice(0,n.to+1),a=s.path.slice(s.from);return{path:r.concat(a),from:n.from,to:r.length+s.to}}}throw new Error("Complex Train routing for Lines of LineGroups not yet implemented")}getLinesWithStop(t){const e=[];for(const i of Object.values(this._lines)){const n=i.getStop(t);null!=n&&e.push({line:i,stop:n})}return e}getPathBetweenStops(t,e,i){const n=t.path;let r=this.indexOf(n,e.coord||s.Vector.NULL),a=this.indexOf(n,i.coord||s.Vector.NULL);if(-1==r||-1==a)throw new Error("Stop that should be present is not present on line "+t.name);const o=n.slice();return r>a&&(o.reverse(),r=o.length-1-r,a=o.length-1-a),{path:o,from:r,to:a}}indexOf(t,e){for(let i=0;i<t.length;i++)if(t[i].equals(e))return i;return-1}findCommonStop(t,e){for(const i of Object.values(t.termini))for(const t of Object.values(e.termini))if(i.stationId==t.stationId)return i;return null}updateTermini(){const t={};this._lines.forEach((e=>{e.termini.forEach((e=>{e.trackInfo.includes("*")||(null==t[e.stationId]?t[e.stationId]=1:t[e.stationId]++)}))}));const e=[];for(const[i,s]of Object.entries(t))1==s&&e.push(new n.Stop(i,""));this._termini=e}}},7756:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Network=void 0;const n=i(1238),s=i(294),r=i(7723),a=i(8856),o=i(5400),l=i(1312);e.Network=class{constructor(t,e,i){this.adapter=t,this.drawableSorter=e,this.gravitator=i,this.slideIndex={},this.stations={},this.lineGroups={},this.drawableBuffer=[]}initialize(){this.zoomer=new r.Zoomer(this.adapter.canvasSize,l.Config.default.zoomMaxScale),this.adapter.initialize(this)}stationById(t){return this.stations[t]}lineGroupById(t){return null==this.lineGroups[t]&&(this.lineGroups[t]=new a.LineGroup),this.lineGroups[t]}createVirtualStop(t,e,i){const n=this.adapter.createVirtualStop(t,e,i);return this.stations[t]=n,n}displayInstant(t){t.equals(n.Instant.BIG_BANG)||this.adapter.drawEpoch(t.epoch+"")}timedDrawablesAt(t){return this.isEpochExisting(t.epoch+"")?this.slideIndex[t.epoch][t.second]:[]}drawTimedDrawablesAt(t,e){this.displayInstant(t);const i=this.timedDrawablesAt(t);let n=l.Config.default.zoomDuration;for(let s=0;s<i.length;s++)n=this.populateDrawableBuffer(i[s],n,e,t);return n=this.flushDrawableBuffer(n,e,t),n=this.gravitator.gravitate(n,e),this.zoomer&&(this.adapter.zoomTo(this.zoomer.center,this.zoomer.scale,this.zoomer.duration),this.zoomer.reset()),n}populateDrawableBuffer(t,e,i,n){return this.isDrawableEliglibleForSameBuffer(t,n)||(e=this.flushDrawableBuffer(e,i,n)),this.drawableBuffer.push(t),e}sortDrawableBuffer(t,e){return 0==this.drawableBuffer.length?[]:this.drawableSorter.sort(this.drawableBuffer,this.isDraw(this.drawableBuffer[this.drawableBuffer.length-1],t),e)}flushDrawableBuffer(t,e,i){const n=this.sortDrawableBuffer(i,e),s=n.length==this.drawableBuffer.length;let r=t;for(let a=0;a<this.drawableBuffer.length;a++){const o=s?t+n[a].delay:r,l=!!s&&n[a].reverse,h=this.drawOrEraseElement(this.drawableBuffer[a],o,e,l,i);r=Math.max(h,r)}return this.drawableBuffer=[],r}isDraw(t,e){return e.equals(t.from)}isDrawableEliglibleForSameBuffer(t,e){var i,n;if(0==this.drawableBuffer.length)return!0;const s=this.drawableBuffer[this.drawableBuffer.length-1];return t.name==s.name&&(this.isDraw(t,e)==this.isDraw(s,e)&&!(t instanceof o.Line&&s instanceof o.Line&&(null===(i=t.animOrder)||void 0===i?void 0:i.degrees)!=(null===(n=s.animOrder)||void 0===n?void 0:n.degrees)))}drawOrEraseElement(t,e,i,n,s){const r=this.isDraw(t,s),a=r?t.from:t.to,o=this.shouldAnimate(a,i),l=n!=a.flag.includes("reverse");return e+=r?this.drawElement(t,e,o,l):this.eraseElement(t,e,o,l),this.zoomer&&this.zoomer.include(t.boundingBox,t.from,t.to,r,i),e}drawElement(t,e,i,n){return t instanceof o.Line&&this.gravitator.addEdge(t,this),t.draw(e,i,n)}eraseElement(t,e,i,n){return t instanceof o.Line&&this.gravitator.removeEdge(t),t.erase(e,i,n)}shouldAnimate(t,e){return!!e&&(!t.flag.includes("noanim")&&e)}isEpochExisting(t){return null!=this.slideIndex[t]}addToIndex(t){this.setSlideIndexElement(t.from,t),n.Instant.BIG_BANG.equals(t.to)||this.setSlideIndexElement(t.to,t),t instanceof s.Station&&(this.stations[t.id]=t),this.gravitator.setIfCrumpledImage(t)}setSlideIndexElement(t,e){null==this.slideIndex[t.epoch]&&(this.slideIndex[t.epoch]={}),null==this.slideIndex[t.epoch][t.second]&&(this.slideIndex[t.epoch][t.second]=[]),this.slideIndex[t.epoch][t.second].push(e)}nextInstant(t){let e=t.epoch,i=this.findSmallestAbove(t.second,this.slideIndex[t.epoch]);if(null==i){if(e=this.findSmallestAbove(t.epoch,this.slideIndex),null==e)return null;if(i=this.findSmallestAbove(-1,this.slideIndex[e]),null==i)return null}return new n.Instant(e,i,"")}findSmallestAbove(t,e){if(null==e)return null;let i=null;for(const[n,s]of Object.entries(e))parseInt(n)>t&&(null==i||parseInt(n)<i)&&(i=parseInt(n));return i}}},7642:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PreferredTrack=void 0;class i{constructor(t){this.value=t}fromString(t){return""!=t?new i(t):this}fromNumber(t){return new i((t>=0?"+":"")+t)}fromExistingLineAtStation(t){return null==t||this.hasTrackNumber()?this:this.fromNumber(t.track)}keepOnlySign(){const t=this.value[0];return new i("-"==t?t:"+")}hasTrackNumber(){return this.value.length>1}get trackNumber(){return parseInt(this.value.replace("*",""))}isPositive(){return"-"!=this.value[0]}}e.PreferredTrack=i},5802:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Projection=void 0;const n=i(1312),s=i(7858);class r{constructor(t){if(this._projection=t,!(t in r.projections))throw new Error("Unknown projection: "+t)}static get default(){return this._default||(this._default=new r(n.Config.default.mapProjection))}project(t){return r.projections[this._projection](t).scale(n.Config.default.mapProjectionScale).round(1)}}e.Projection=r,r.projections={epsg3857:t=>new s.Vector(256/Math.PI*(t.x/180*Math.PI+Math.PI),256/Math.PI*(Math.PI-Math.log(Math.tan(Math.PI/4+t.y/180*Math.PI/2))))}},9059:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Rotation=void 0;const n=i(5936);class s{constructor(t){this._degrees=t}static from(t){return new s(s.DIRS[t]||0)}get name(){for(const[t,e]of Object.entries(s.DIRS))if(n.Utils.equals(e,this.degrees))return t;return"n"}get degrees(){return this._degrees}get radians(){return this.degrees/180*Math.PI}add(t){let e=this.degrees+t.degrees;return e<=-180&&(e+=360),e>180&&(e-=360),new s(e)}delta(t){let e=this.degrees,i=t.degrees,n=i-e;return Math.abs(n)>180&&(e<0&&(e+=360),i<0&&(i+=360),n=i-e),new s(n)}normalize(){let t=this.degrees;return n.Utils.equals(t,-90)?t=0:t<-90?t+=180:t>90&&(t-=180),new s(t)}isVertical(){return this.degrees%180==0}quarterDirection(t){const e=t.delta(this).degrees,i=e<0?Math.ceil((e-45)/90):Math.floor((e+45)/90);return new s(90*i)}halfDirection(t,e){const i=t.delta(this).degrees;let n;return n=e.isVertical()?i<0&&i>=-180?-90:90:i<90&&i>=-90?0:180,new s(n)}nearestRoundedInDirection(t,e){const i=t.round(e),n=Math.abs(i.degrees-this.degrees)%90;return this.add(new s(Math.sign(e)*n))}round(t){const e=this.degrees/45;return new s(45*(t>=0?Math.ceil(e):Math.floor(e)))}}e.Rotation=s,s.DIRS={sw:-135,w:-90,nw:-45,n:0,ne:45,e:90,se:135,s:180}},4338:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=void 0;class i{static equals(t,e){return Math.abs(t-e)<i.IMPRECISION}static trilemma(t,e){return i.equals(t,0)?e[1]:t>0?e[2]:e[0]}static alphabeticId(t,e){return t<e?t+"_"+e:e+"_"+t}static ease(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}}e.Utils=i,i.IMPRECISION=.001},8119:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector=void 0;const n=i(9591),s=i(5936);class r{constructor(t,e){this._x=t,this._y=e}static fromArray(t){return new r(t[0],t[1])}get x(){return this._x}get y(){return this._y}get length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}withLength(t){const e=0!=this.length?t/this.length:0;return new r(this.x*e,this.y*e)}signedLengthProjectedAt(t){const e=r.UNIT.rotate(t);return this.dotProduct(e)/e.dotProduct(e)}add(t){return new r(this.x+t.x,this.y+t.y)}scale(t){return new r(this.x*t,this.y*t)}delta(t){return new r(t.x-this.x,t.y-this.y)}rotate(t){let e=t.radians;return new r(this.x*Math.cos(e)-this.y*Math.sin(e),this.x*Math.sin(e)+this.y*Math.cos(e))}dotProduct(t){return this.x*t.x+this.y*t.y}solveDeltaForIntersection(t,e){const i=this,n=s.Utils.equals(e.y,0),r=n?"y":"x",a=n?"x":"y",o=t[a]*e[r]-t[r]*e[a];if(s.Utils.equals(o,0))return{a:NaN,b:NaN};const l=(i[a]*e[r]-i[r]*e[a])/o;return{a:l,b:(l*t[a]-i[a])/e[a]}}isDeltaMatchingParallel(t,e){const i=this.angle(t).degrees,n=t.angle(e).degrees;return s.Utils.equals(i%180,0)&&s.Utils.equals(n%180,0)}inclination(){if(s.Utils.equals(this.x,0))return new n.Rotation(this.y>0?180:0);if(s.Utils.equals(this.y,0))return new n.Rotation(this.x>0?90:-90);const t=new r(0,-Math.abs(this.y));return new n.Rotation(Math.sign(this.x)*Math.acos(this.dotProduct(t)/t.length/this.length)*180/Math.PI)}angle(t){return this.inclination().delta(t.inclination())}bothAxisMins(t){return this==r.NULL?t:t==r.NULL?this:new r(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y)}bothAxisMaxs(t){return this==r.NULL?t:t==r.NULL?this:new r(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y)}between(t,e){const i=this.delta(t);return this.add(i.withLength(i.length*e))}equals(t){return this.x==t.x&&this.y==t.y}round(t){return new r(this.roundNumber(this.x,t),this.roundNumber(this.y,t))}roundNumber(t,e){const i=Math.pow(10,e);return Math.round(t*i)/i}}e.Vector=r,r.UNIT=new r(0,-1),r.NULL=new r(0,0)},4740:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Zoomer=void 0;const n=i(7858),s=i(9591),r=i(19),a=i(1312);e.Zoomer=class{constructor(t,e=3){this.canvasSize=t,this.zoomMaxScale=e,this.boundingBox=new r.BoundingBox(n.Vector.NULL,n.Vector.NULL),this.customDuration=-1,this.resetFlag=!1}include(t,e,i,n,s,r=!0){const a=n?e:i;a.flag.includes("keepzoom")?this.resetFlag=!1:(this.resetFlag&&this.doReset(),s&&!a.flag.includes("nozoom")&&(r&&!t.isNull()&&(t=this.paddedBoundingBox(t)),this.boundingBox.add(t.tl,t.br)))}enforcedBoundingBox(){if(!this.boundingBox.isNull()){const t=this.boundingBox,e=t.dimensions,i=this.canvasSize.dimensions,a=new n.Vector(i.x/this.zoomMaxScale,i.y/this.zoomMaxScale),o=e.delta(a),l=new n.Vector(Math.max(0,o.x/2),Math.max(0,o.y/2));return new r.BoundingBox(t.tl.add(l.rotate(new s.Rotation(180))),t.br.add(l))}return this.boundingBox}paddedBoundingBox(t){const e=a.Config.default.zoomPaddingFactor*Math.min(this.zoomMaxScale,8);return new r.BoundingBox(t.tl.add(new n.Vector(-e,-e)),t.br.add(new n.Vector(e,e)))}get center(){const t=this.enforcedBoundingBox();return t.isNull()?this.canvasSize.tl.between(this.canvasSize.br,.5):new n.Vector(Math.round((t.tl.x+t.br.x)/2),Math.round((t.tl.y+t.br.y)/2))}get scale(){const t=this.enforcedBoundingBox();if(!t.isNull()){const e=t.dimensions,i=this.canvasSize.dimensions;return Math.min(i.x/e.x,i.y/e.y)}return 1}get duration(){return-1==this.customDuration?a.Config.default.zoomDuration:this.customDuration}doReset(){this.boundingBox=new r.BoundingBox(n.Vector.NULL,n.Vector.NULL),this.customDuration=-1,this.resetFlag=!1}reset(){this.resetFlag=!0}}},8860:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractTimedDrawable=void 0;e.AbstractTimedDrawable=class{constructor(t){this.adapter=t,this._from=this.adapter.from,this._to=this.adapter.to,this._name=this.adapter.name,this._boundingBox=this.adapter.boundingBox}get from(){return this._from}get to(){return this._to}get name(){return this._name}get boundingBox(){return this._boundingBox}}},4394:function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.CrumpledImage=void 0;const s=i(7858),r=n(i(5246)),a=i(9732);class o extends a.AbstractTimedDrawable{constructor(t){super(t),this.adapter=t,this.vertices=[],this.triangles=[],this.canvasSides=[]}initialize(t){this.vertices=t.map((t=>({currentCoords:()=>t.baseCoords,startCoords:t.baseCoords}))),this.canvasSides=this.getCanvasSides();let e=this.getDelaunator();this.setVerticesExtendedToCanvasBoundaries(e.triangles,e.halfedges),e=this.getDelaunator(),this.setTriangles(e.triangles)}getDelaunator(){return r.default.from(this.vertices,(t=>t.startCoords.x),(t=>t.startCoords.y))}getCanvasSides(){const t=this.adapter.boundingBox.tl,e=this.adapter.boundingBox.br,i=new s.Vector(e.x,t.y),n=new s.Vector(t.x,e.y);return[{corner:t,side:new s.Vector(i.x-t.x,0)},{corner:i,side:new s.Vector(0,e.y-i.y)},{corner:e,side:new s.Vector(n.x-e.x,0)},{corner:n,side:new s.Vector(0,t.y-n.y)}]}setVerticesExtendedToCanvasBoundaries(t,e){for(let i=0;i<e.length;i++)if(-1==e[i]){const e=this.vertices[t[i]],n=this.vertices[t[this.prevHalfedge(i)]],s=this.vertices[t[this.nextHalfedge(i)]],r=n.startCoords.delta(s.startCoords),a=n.startCoords.delta(e.startCoords),o=this.factorToExtendVectorToCanvasBoundaries(n.startCoords,r),l=this.factorToExtendVectorToCanvasBoundaries(n.startCoords,a),h=n.startCoords.add(r.scale(o)),d=n.startCoords.add(a.scale(l));this.vertices.push({currentCoords:()=>this.extendCurrentVector(n,s,o),startCoords:h}),this.vertices.push({currentCoords:()=>this.extendCurrentVector(n,e,l),startCoords:d})}}nextHalfedge(t){return t%3==2?t-2:t+1}prevHalfedge(t){return t%3==0?t+2:t-1}factorToExtendVectorToCanvasBoundaries(t,e){for(let i=0;i<this.canvasSides.length;i++){const n=this.canvasSides[i].corner.delta(t).solveDeltaForIntersection(this.canvasSides[i].side,e);if(n.a>=0&&n.a<=1&&n.b>=0)return n.b*o.EXTEND_BEYOND_CANVAS_FACTOR}throw new Error(e+" does not seem to intersect with canvas boundaries, which is impossible.")}extendCurrentVector(t,e,i){return t.currentCoords().add(t.currentCoords().delta(e.currentCoords()).scale(i))}setTriangles(t){for(let e=0;e<t.length;e+=3)this.triangles.push({a:this.vertices[t[e]],b:this.vertices[t[e+1]],c:this.vertices[t[e+2]]})}draw(t,e,i){return this.adapter.draw(t,0,[]),0}crumple(t,e){return this.adapter.draw(t,e,this.triangles),0}erase(t,e,i){return this.adapter.erase(t),0}}e.CrumpledImage=o,o.EXTEND_BEYOND_CANVAS_FACTOR=2},6335:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GenericTimedDrawable=void 0;const n=i(9732),s=i(1312);class r extends n.AbstractTimedDrawable{constructor(t){super(t),this.adapter=t}draw(t,e){return this.adapter.draw(t,e?s.Config.default.fadeDurationSeconds:0),0}erase(t,e,i){return this.adapter.erase(t,e?s.Config.default.fadeDurationSeconds:0),0}}e.GenericTimedDrawable=r},3540:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.KenImage=void 0;const n=i(7858),s=i(7723),r=i(1238),a=i(9732);class o extends a.AbstractTimedDrawable{constructor(t){super(t),this.adapter=t}draw(t,e){const i=new s.Zoomer(this.boundingBox);return i.include(this.getZoomedBoundingBox(),r.Instant.BIG_BANG,r.Instant.BIG_BANG,!0,!0,!1),this.adapter.draw(t,e?this.adapter.from.delta(this.adapter.to):0,i.center,i.scale),0}erase(t,e,i){return this.adapter.erase(t),0}getZoomedBoundingBox(){const t=this.adapter.boundingBox,e=this.adapter.zoom;if(e!=n.Vector.NULL){return t.calculateBoundingBoxForZoom(e.x,e.y)}return t}}e.KenImage=o},7968:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Label=void 0;const n=i(9591),s=i(7858),r=i(9732),a=i(1312);class o extends r.AbstractTimedDrawable{constructor(t,e){super(t),this.adapter=t,this.stationProvider=e,this.children=[]}hasChildren(){return this.children.length>0}get name(){return this.adapter.forStation||this.adapter.forLine||""}get forStation(){const t=this.stationProvider.stationById(this.adapter.forStation||"");if(null==t)throw new Error("Station with ID "+this.adapter.forStation+" is undefined");return t}draw(t,e){const i=e?a.Config.default.fadeDurationSeconds:0;if(null!=this.adapter.forStation){const n=this.forStation;n.addLabel(this),n.linesExisting()?this.drawForStation(t,i,n,!1):this.adapter.erase(t,e?a.Config.default.fadeDurationSeconds:0)}else if(null!=this.adapter.forLine){this.stationProvider.lineGroupById(this.adapter.forLine).termini.forEach((i=>{const n=this.stationProvider.stationById(i.stationId);if(null!=n){let i=!1;if(n.labels.forEach((n=>{n.hasChildren()&&(i=!0,n.children.push(this),n.draw(t,e))})),!i){const i=new o(this.adapter.cloneForStation(n.id),this.stationProvider);i.children.push(this),n.addLabel(i),i.draw(t,e),this.children.push(i)}}}))}else this.adapter.draw(t,i,s.Vector.NULL,n.Rotation.from("n"),[]);return 0}drawForStation(t,e,i,r){const o=i.baseCoords;let l=0;for(let t=0;t<i.labels.length;t++){if(i.labels[t]==this)break;l+=1.5*a.Config.default.labelHeight}const h=i.labelDir;l=Math.sign(s.Vector.UNIT.rotate(h).y)*l-(l>0?2:0);const d=i.rotation,c=h.add(new n.Rotation(-d.degrees)),u=s.Vector.UNIT.rotate(c),g=new s.Vector(i.stationSizeForAxis("x",u.x),i.stationSizeForAxis("y",u.y)),f=o.add(g.rotate(d)).add(new s.Vector(0,l));this.adapter.draw(t,e,f,h,this.children.map((t=>t.adapter)))}erase(t,e,i){return null!=this.adapter.forStation?(this.forStation.removeLabel(this),this.adapter.erase(t,e?a.Config.default.fadeDurationSeconds:0)):null!=this.adapter.forLine?this.children.forEach((n=>{n.erase(t,e,i)})):this.adapter.erase(t,e?a.Config.default.fadeDurationSeconds:0),0}}e.Label=o},95:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Line=void 0;const n=i(7858),s=i(9591),r=i(5936),a=i(9499),o=i(9732),l=i(1312);class h extends o.AbstractTimedDrawable{constructor(t,e,i=l.Config.default){super(t),this.adapter=t,this.stationProvider=e,this.config=i,this.weight=this.adapter.weight,this.animOrder=this.adapter.animOrder,this.precedingStop=void 0,this.precedingDir=void 0,this._path=[]}draw(t,e,i){this.adapter.totalLength>0||this.createLine(t,e);let n=this.getAnimationDuration(this._path,e);const s=this.stationProvider.lineGroupById(this.name);return s.addLine(this),this.adapter.draw(t,n,i,this._path,this.getTotalLength(this._path),s.strokeColor),n}move(t,e,i,n){let s=this._path;if(s.length<2||i.length<2)return void console.warn("Trying to move a non-existing line");s.length!=i.length&&(s=[s[0],s[s.length-1]],i=[i[0],i[i.length-1]]);const r=this.stationProvider.lineGroupById(this.name);this.adapter.move(t,e,this._path,i,r.strokeColor,n),r.strokeColor=n,this._path=i}erase(t,e,i){let n=this.getAnimationDuration(this._path,e);this.stationProvider.lineGroupById(this.name).removeLine(this),this.adapter.erase(t,n,i,this.getTotalLength(this._path));const s=this.adapter.stops;for(let i=0;i<s.length;i++){const n=this.stationProvider.stationById(s[i].stationId);if(null==n)throw new Error(this.name+": Station with ID "+s[i].stationId+" is undefined");if(n.removeLine(this),n.draw(t,e),i>0){const t="h_"+r.Utils.alphabeticId(s[i-1].stationId,s[i].stationId);let e=this.stationProvider.stationById(t);null!=e&&e.removeLine(this)}}return n}createLine(t,e){const i=this.adapter.stops,n=this._path;let s=new a.PreferredTrack("+");for(let r=0;r<i.length;r++){s=s.fromString(i[r].trackInfo);const a=this.stationProvider.stationById(i[r].stationId);if(null==a)throw new Error(this.name+": Station with ID "+i[r].stationId+" is undefined");0==n.length&&(s=s.fromExistingLineAtStation(a.axisAndTrackForExistingLine(this.name))),i[r].coord=this.createConnection(a,this.nextStopBaseCoord(i,r,a.baseCoords),s,n,t,e,!0),s=s.keepOnlySign()}}nextStopBaseCoord(t,e,i){if(e+1<t.length){const i=t[e+1].stationId,n=this.stationProvider.stationById(i);if(null==n)throw new Error(this.name+": Station with ID "+i+" is undefined");return n.baseCoords}return i}createConnection(t,e,i,n,r,a,o){const l=t.rotation,h=t.baseCoords,d=this.getStopOrientationBasedOnThreeStops(t,e,l,n),c=t.assignTrack(d.isVertical()?"x":"y",i,this),u=t.rotatedTrackCoordinates(d,c);if(0!=n.length){const c=n[n.length-1];this.precedingDir=this.getPrecedingDir(this.precedingDir,this.precedingStop,c,u);const g=d.add(l),f=this.insertNode(c,this.precedingDir,u,g,n);if(!f&&o&&null!=this.precedingStop){const o=this.getOrCreateHelperStop(this.precedingDir,this.precedingStop,t);return this.precedingDir=this.precedingDir.add(new s.Rotation(180)),this.createConnection(o,h,i.keepOnlySign(),n,r,a,!1),this.createConnection(t,e,i,n,r,a,!1)}f||console.warn("path to fix on line",this.adapter.name,"at station",t.id),this.precedingDir=g}return t.addLine(this,d.isVertical()?"x":"y",c),n.push(u),r=this.getAnimationDuration(n,a)+r,t.draw(r,a),this.precedingStop=t,u}getStopOrientationBasedOnThreeStops(t,e,i,n){var r;if(0!=n.length){const t=n[n.length-1];return e.delta(t).inclination().quarterDirection(i)}const a=t.baseCoords.delta(e),o=null===(r=t.axisAndTrackForExistingLine(this.name))||void 0===r?void 0:r.axis;if(null!=o){const t=a.inclination().halfDirection(i,"x"==o?new s.Rotation(90):new s.Rotation(0));return null==this.precedingDir&&(this.precedingDir=t.add(i).add(new s.Rotation(180))),t}return a.inclination().quarterDirection(i)}getPrecedingDir(t,e,i,n){var r;if(null==t){const a=null!==(r=null==e?void 0:e.rotation)&&void 0!==r?r:new s.Rotation(0);t=i.delta(n).inclination().quarterDirection(a).add(a)}else t=t.add(new s.Rotation(180));return t}insertNode(t,e,i,s,r){if(!this.config.beckStyle||!this.adapter.beckStyle)return!0;const a=t.delta(i),o=n.Vector.UNIT.rotate(e),h=n.Vector.UNIT.rotate(s);if(a.isDeltaMatchingParallel(o,h))return!0;const d=a.solveDeltaForIntersection(o,h);return d.a>l.Config.default.minNodeDistance&&d.b>l.Config.default.minNodeDistance&&(r.push(new n.Vector(t.x+o.x*d.a,t.y+o.y*d.a)),!0)}getOrCreateHelperStop(t,e,i){const n="h_"+r.Utils.alphabeticId(e.id,i.id);let s=this.stationProvider.stationById(n);if(null==s){const r=e.baseCoords,a=i.baseCoords,o=a.delta(r),l=r.delta(a).inclination(),h=e.rotation.nearestRoundedInDirection(l,t.delta(l).degrees),d=o.withLength(o.length/2).add(a);s=this.stationProvider.createVirtualStop(n,d,h)}return s}get animationDurationSeconds(){return this.getAnimationDuration(this._path,!0)}get speed(){return this.adapter.speed||l.Config.default.animSpeed}getAnimationDuration(t,e){return e?this.getTotalLength(t)/this.speed:0}getTotalLength(t){const e=this.adapter.totalLength;if(e>0)return e;let i=0;for(let e=0;e<t.length-1;e++)i+=t[e].delta(t[e+1]).length;return i}get termini(){const t=this.adapter.stops;return 0==t.length?[]:[t[0],t[t.length-1]]}get path(){return 0==this._path.length?this.adapter.termini:this._path}getStop(t){for(const e of Object.values(this.adapter.stops))if(e.stationId==t)return e;return null}}e.Line=h},8869:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Station=e.Stop=void 0;const n=i(7858),s=i(5936),r=i(19),a=i(9732),o=i(900),l=i(1312);e.Stop=class{constructor(t,e){this.stationId=t,this.trackInfo=e,this.coord=null}};class h extends a.AbstractTimedDrawable{constructor(t){super(t),this.adapter=t,this.existingLines={x:[],y:[]},this.existingLabels=[],this.phantom=void 0,this.rotation=this.adapter.rotation,this.labelDir=this.adapter.labelDir,this.id=this.adapter.id,null!=this.adapter.lonLat&&(this.adapter.baseCoords=o.Projection.default.project(this.adapter.lonLat))}get baseCoords(){return this.adapter.baseCoords}set baseCoords(t){this.adapter.baseCoords=t}get boundingBox(){return new r.BoundingBox(this.adapter.baseCoords,this.adapter.baseCoords)}addLine(t,e,i){this.phantom=void 0,this.existingLines[e].push({line:t,axis:e,track:i})}removeLine(t){this.removeLineAtAxis(t,this.existingLines.x),this.removeLineAtAxis(t,this.existingLines.y)}addLabel(t){this.existingLabels.includes(t)||this.existingLabels.push(t)}removeLabel(t){let e=0;for(;e<this.existingLabels.length;)this.existingLabels[e]==t?this.existingLabels.splice(e,1):e++}get labels(){return this.existingLabels}removeLineAtAxis(t,e){let i=0;for(;i<e.length;)e[i].line==t?(this.phantom=e[i],e.splice(i,1)):i++}axisAndTrackForExistingLine(t){const e=this.trackForLineAtAxis(t,this.existingLines.x);if(null!=e)return e;const i=this.trackForLineAtAxis(t,this.existingLines.y);return null!=i?i:void 0}trackForLineAtAxis(t,e){var i;let n=0;for(;n<e.length;){if((null===(i=e[n].line)||void 0===i?void 0:i.name)==t)return e[n];n++}}assignTrack(t,e,i){var n,s,r,a;if(e.hasTrackNumber())return e.trackNumber;if((null===(s=null===(n=this.phantom)||void 0===n?void 0:n.line)||void 0===s?void 0:s.name)==i.name&&(null===(r=this.phantom)||void 0===r?void 0:r.axis)==t)return null===(a=this.phantom)||void 0===a?void 0:a.track;const o=this.positionBoundaries()[t];return e.isPositive()?o[1]+1:o[0]-1}rotatedTrackCoordinates(t,e){let i;return i=t.degrees%180==0?new n.Vector(e*l.Config.default.lineDistance,0):new n.Vector(0,e*l.Config.default.lineDistance),i=i.rotate(this.rotation),i=this.baseCoords.add(i),i}positionBoundaries(){return{x:this.positionBoundariesForAxis(this.existingLines.x),y:this.positionBoundariesForAxis(this.existingLines.y)}}positionBoundariesForAxis(t){if(0==t.length)return[1,-1];let e=0,i=0;for(let n=0;n<t.length;n++)i<t[n].track&&(i=t[n].track),e>t[n].track&&(e=t[n].track);return[e,i]}draw(t,e){this.existingLabels.forEach((i=>i.draw(t,e)));const i=this.positionBoundaries();return this.adapter.draw(t,e?l.Config.default.fadeDurationSeconds:0,(function(){return i})),0}move(t,e,i){const n=this;this.adapter.move(t,e,this.baseCoords,i,(()=>n.existingLabels.forEach((t=>t.draw(0,!1)))))}erase(t,e){return this.adapter.erase(t,e?l.Config.default.fadeDurationSeconds:0),0}stationSizeForAxis(t,e){if(s.Utils.equals(e,0))return 0;const i=Math.sign(e);let n=this.positionBoundariesForAxis(this.existingLines[t])[e<0?0:1];return i*n<0&&(n=0),n*l.Config.default.lineDistance+i*(l.Config.default.defaultStationDimen+l.Config.default.labelDistance)}linesExisting(){return this.existingLines.x.length>0||this.existingLines.y.length>0}}e.Station=h},8999:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Train=void 0;const n=i(8199),s=i(9732),r=i(1312);class a extends s.AbstractTimedDrawable{constructor(t,e,i){super(t),this.adapter=t,this.stationProvider=e,this.config=i}draw(t,e){const i=this.stationProvider.lineGroupById(this.name),s=this.adapter.stops;if(s.length<2)throw new Error("Train "+this.name+" needs at least 2 stops");for(let a=1;a<s.length;a++){const o=new n.ArrivalDepartureTime(s[a].trackInfo),l=i.getPathBetween(s[a-1].stationId,s[a].stationId);if(null==l)throw new Error(this.name+": No path found between "+s[a-1].stationId+" "+s[a].stationId);1==a&&this.adapter.draw(t,e?r.Config.default.fadeDurationSeconds:0,l),e&&this.adapter.move(t+this.scaleSpeed(o.departure)-this.from.second,this.scaleSpeed(o.arrival-o.departure),l)}return 0}erase(t,e,i){return this.adapter.erase(t,e?r.Config.default.fadeDurationSeconds:0),0}scaleSpeed(t){return t/this.config.trainTimetableSpeed*60}}e.Train=a},2632:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Rotation=e.Vector=e.Projection=e.Config=e.SvgAnimator=void 0;const n=i(3721),s=i(4073),r=i(1238),a=i(71),o=i(2358),l=i(1312),h=i(6668);var d=i(71);Object.defineProperty(e,"SvgAnimator",{enumerable:!0,get:function(){return d.SvgAnimator}});var c=i(1312);Object.defineProperty(e,"Config",{enumerable:!0,get:function(){return c.Config}});var u=i(900);Object.defineProperty(e,"Projection",{enumerable:!0,get:function(){return u.Projection}});var g=i(7858);Object.defineProperty(e,"Vector",{enumerable:!0,get:function(){return g.Vector}});var f=i(9591);Object.defineProperty(e,"Rotation",{enumerable:!0,get:function(){return f.Rotation}});let m=0;const p=new s.Network(new n.SvgNetwork,new o.DrawableSorter,new h.Gravitator);let x=!1,v=!1;const w=function(){if(window.location.hash){const t=window.location.hash.replace("#","").split("-"),e=new r.Instant(parseInt(t[0])||0,parseFloat(t[1])||0,"");return v="stop"==t[2],console.log("fast forward to",e),e}return r.Instant.BIG_BANG}();function b(){p.initialize(),y(r.Instant.BIG_BANG,!1)}function y(t,e){t!=r.Instant.BIG_BANG&&t.epoch>=w.epoch&&t.second>=w.second&&(e=!0),console.log(t,"time: "+Math.floor(m/60)+":"+m%60),p.drawTimedDrawablesAt(t,e);const i=p.nextInstant(t);if(v&&e||!i)console.log("Stopped.");else{const n=t.delta(i);m+=n;const s=e?n:0;(new a.SvgAnimator).wait(1e3*s,(()=>y(i,e)))}}l.Config.default.autoStart&&(x=!0,b()),document.addEventListener("startTransportNetworkAnimator",(function(t){x&&console.warn('transport-network-animator already started. You should probably set data-auto-start="false". Starting anyways.'),x=!0,b()}))},8537:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgAbstractTimedDrawable=void 0;const n=i(1238),s=i(7858),r=i(19),a=i(71),o=i(2531);e.SvgAbstractTimedDrawable=class{constructor(t){this.element=t}get name(){return this.element.getAttribute("name")||this.element.getAttribute("src")||""}get from(){return this.getInstant("from")}get to(){return this.getInstant("to")}get boundingBox(){const t=this.element.getBBox();if(null!=document.getElementById("zoomable")){const t=document.getElementById("zoomable"),e=t.getBoundingClientRect(),i=t.getBBox(),n=this.element.getBoundingClientRect(),a=i.width/e.width,o=(n.x-e.x)*a+i.x,l=(n.y-e.y)*a+i.y;return new r.BoundingBox(new s.Vector(o,l),new s.Vector(o+n.width*a,l+n.height*a))}return new r.BoundingBox(new s.Vector(t.x,t.y),new s.Vector(t.x+t.width,t.y+t.height))}getInstant(t){var e;if(null!=this.element.dataset[t]){const i=null===(e=this.element.dataset[t])||void 0===e?void 0:e.split(/\s+/);if(null!=i)return n.Instant.from(i)}return n.Instant.BIG_BANG}show(t){if(0==t)this.element.style.visibility="visible";else if("visible"!=getComputedStyle(this.element).visibility){this.element.style.opacity="0",this.element.style.visibility="visible";(new a.SvgAnimator).ease(o.Animator.EASE_CUBIC).animate(1e3*t,((t,e)=>(this.element.style.opacity=t+"",!0)))}}hide(t){if(0!=t){this.element.style.opacity="1";(new a.SvgAnimator).ease(o.Animator.EASE_CUBIC).from(1).to(0).animate(1e3*t,((t,e)=>(this.element.style.opacity=t+"",e&&(this.element.style.visibility="hidden"),!0)))}else this.element.style.visibility="hidden"}}},5836:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgAnimator=void 0;const n=i(2531);class s extends n.Animator{constructor(){super()}now(){return performance.now()}timeout(t,e){window.setTimeout(t,e)}requestFrame(t){window.requestAnimationFrame(t)}}e.SvgAnimator=s},3966:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgCrumpledImage=void 0;const n=i(7858),s=i(71),r=i(6844),a=i(19);class o extends r.SvgAbstractTimedDrawable{constructor(t){super(t),this.element=t,this.imgDimen=n.Vector.NULL,this.canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.img=document.createElementNS("http://www.w3.org/1999/xhtml","img"),this.setupImage()}get boundingBox(){if(null==this.canvasBoundingBox){const t=this.element.getBBox();this.canvasBoundingBox=new a.BoundingBox(new n.Vector(t.x,t.y),new n.Vector(t.x+t.width,t.y+t.height))}return this.canvasBoundingBox}get crumpledImage(){return this.element.dataset.crumpledImage||""}setupImage(){this.img.src=this.crumpledImage,this.img.style.visibility="hidden",this.canvas.setAttribute("width",this.boundingBox.dimensions.x+""),this.canvas.setAttribute("height",this.boundingBox.dimensions.y+""),this.element.appendChild(this.canvas),this.img.onload=t=>{const e=this.canvas.getContext("2d");this.imgDimen=new n.Vector(this.img.width,this.img.height),null==e||e.drawImage(this.img,0,0,this.boundingBox.dimensions.x,this.boundingBox.dimensions.y)},this.element.appendChild(this.img)}draw(t,e,i){const n=new s.SvgAnimator;n.wait(1e3*t,(()=>{this.element.style.visibility="visible";const t=this.canvas.getContext("2d");null!=t&&i.length>0&&n.animate(1e3*e,((e,n)=>(this.mapTriangles(i,t),!0)))}))}erase(t){(new s.SvgAnimator).wait(1e3*t,(()=>{this.element.style.visibility="hidden"}))}mapTriangles(t,e){e.clearRect(0,0,this.boundingBox.dimensions.x,this.boundingBox.dimensions.y);for(let i=0;i<t.length;i++){const n=t[i],s=[n.a,n.b,n.c],r=s.map((t=>this.svg2ImgCoords(t.startCoords))),a=s.map((t=>this.svg2CanvasCoords(t.currentCoords())));this.drawTriangle(e,this.img,a[0],a[1],a[2],r[0],r[1],r[2])}}svg2ImgCoords(t){const e=this.imgDimen.x/this.boundingBox.dimensions.x,i=this.imgDimen.y/this.boundingBox.dimensions.y,s=this.svg2CanvasCoords(t);return new n.Vector(s.x*e,s.y*i)}svg2CanvasCoords(t){return this.boundingBox.tl.delta(t)}drawTriangle(t,e,i,n,s,r,a,o){t.save(),t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(n.x,n.y),t.lineTo(s.x,s.y),t.closePath(),t.clip();var l=r.x*(o.y-a.y)-a.x*o.y+o.x*a.y+(a.x-o.x)*r.y;if(0!=l){var h=-(r.y*(s.x-n.x)-a.y*s.x+o.y*n.x+(a.y-o.y)*i.x)/l,d=(a.y*s.y+r.y*(n.y-s.y)-o.y*n.y+(o.y-a.y)*i.y)/l,c=(r.x*(s.x-n.x)-a.x*s.x+o.x*n.x+(a.x-o.x)*i.x)/l,u=-(a.x*s.y+r.x*(n.y-s.y)-o.x*n.y+(o.x-a.x)*i.y)/l,g=(r.x*(o.y*n.x-a.y*s.x)+r.y*(a.x*s.x-o.x*n.x)+(o.x*a.y-a.x*o.y)*i.x)/l,f=(r.x*(o.y*n.y-a.y*s.y)+r.y*(a.x*s.y-o.x*n.y)+(o.x*a.y-a.x*o.y)*i.y)/l;t.transform(h,d,c,u,g,f),t.drawImage(e,0,0),t.restore()}}}e.SvgCrumpledImage=o},7862:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgGenericTimedDrawable=void 0;const n=i(71),s=i(6844);class r extends s.SvgAbstractTimedDrawable{constructor(t){super(t),this.element=t}draw(t,e){(new n.SvgAnimator).wait(1e3*t,(()=>{this.show(e),"g"==this.element.localName&&(0==e&&(this.element.style.opacity="1"),null!=this.element.onfocus&&this.element.focus())}))}erase(t,e){(new n.SvgAnimator).wait(1e3*t,(()=>{this.hide(e),"g"==this.element.localName&&(this.element.style.opacity="0")}))}}e.SvgGenericTimedDrawable=r},6823:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgKenImage=void 0;const n=i(7858),s=i(71),r=i(6844),a=i(19);class o extends r.SvgAbstractTimedDrawable{constructor(t){super(t),this.element=t}get boundingBox(){const t=this.element.getBBox();return new a.BoundingBox(new n.Vector(t.x,t.y),new n.Vector(t.x+t.width,t.y+t.height))}get zoom(){if(null!=this.element.dataset.zoom){const t=this.element.dataset.zoom.split(" ");return new n.Vector(parseInt(t[0])||50,parseInt(t[1])||50)}return n.Vector.NULL}draw(t,e,i,n){const r=new s.SvgAnimator;r.wait(1e3*t,(()=>{if(this.element.style.visibility="visible",e>0){const t=this.boundingBox.tl.between(this.boundingBox.br,.5);r.animate(1e3*e,((e,s)=>this.animateFrame(e,s,t,i,1,n)))}}))}animateFrame(t,e,i,s,r,a){if(e)this.updateZoom(s,a);else{const e=i.delta(s),o=new n.Vector(e.x*t,e.y*t).add(i),l=(a-r)*t+r;this.updateZoom(o,l)}return!0}updateZoom(t,e){const i=this.element;if(null!=i){const n=this.boundingBox.tl.between(this.boundingBox.br,.5);i.style.transformOrigin=n.x+"px "+n.y+"px",i.style.transform="scale("+e+") translate("+(n.x-t.x)+"px,"+(n.y-t.y)+"px)"}}erase(t){(new s.SvgAnimator).wait(1e3*t,(()=>{this.element.style.visibility="hidden"}))}}e.SvgKenImage=o},8859:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgLabel=void 0;const n=i(7858),s=i(5936),r=i(19),a=i(71),o=i(6844),l=i(1312);class h extends o.SvgAbstractTimedDrawable{constructor(t){super(t),this.element=t}get forStation(){return this.element.dataset.station}get forLine(){return this.element.dataset.line}get boundingBox(){return"visible"==this.element.style.visibility?super.boundingBox:new r.BoundingBox(n.Vector.NULL,n.Vector.NULL)}draw(t,e,i,s,r){(new a.SvgAnimator).wait(1e3*t,(()=>{i!=n.Vector.NULL?(this.setCoord(this.element,i),r.length>0?this.drawLineLabels(e,s,r):this.drawStationLabel(e,s)):this.show(e)}))}translate(t,e,i){const r=n.Vector.UNIT.rotate(i);this.element.style.transform="translate("+s.Utils.trilemma(r.x,[-e.x+"px",-e.x/2+"px","0px"])+","+s.Utils.trilemma(r.y,[-l.Config.default.labelHeight+"px",-l.Config.default.labelHeight/2+"px","0px"])+")",this.show(t)}drawLineLabels(t,e,i){this.element.children[0].innerHTML="",i.forEach((t=>{t instanceof h&&this.drawLineLabel(t)}));const s=this.element.getBoundingClientRect().width/Math.max(this.element.getBBox().width,1),r=this.element.children[0].getBoundingClientRect();this.translate(t,new n.Vector(r.width/s,r.height/s),e)}drawLineLabel(t){const e=document.createElementNS("http://www.w3.org/1999/xhtml","div");e.className=t.classNames,e.innerHTML=t.text,this.element.children[0].appendChild(e)}drawStationLabel(t,e){this.element.className.baseVal.includes("for-station")||(this.element.className.baseVal+=" for-station"),this.element.style.dominantBaseline="hanging",this.translate(t,new n.Vector(this.element.getBBox().width,this.element.getBBox().height),e)}erase(t,e){(new a.SvgAnimator).wait(1e3*t,(()=>{this.hide(e)}))}setCoord(t,e){t.setAttribute("x",e.x),t.setAttribute("y",e.y)}get classNames(){return this.element.className.baseVal+" "+this.forLine}get text(){return this.element.innerHTML}cloneForStation(t){var e;const i=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");i.className.baseVal+=" for-line",i.dataset.station=t,i.setAttribute("width","1");const n=document.createElementNS("http://www.w3.org/1999/xhtml","div");return i.appendChild(n),null===(e=this.element.parentElement)||void 0===e||e.appendChild(i),new h(i)}}e.SvgLabel=h},2565:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgLine=void 0;const n=i(7858),s=i(19),r=i(71),a=i(6844),o=i(300),l=i(9591);class h extends a.SvgAbstractTimedDrawable{constructor(t){super(t),this.element=t,this._stops=[],this._boundingBox=new s.BoundingBox(n.Vector.NULL,n.Vector.NULL)}get name(){return this.element.dataset.line||""}get boundingBox(){return this._boundingBox}get weight(){if(null!=this.element.dataset.weight)return parseInt(this.element.dataset.weight)}get beckStyle(){return null==this.element.dataset.beckStyle||"false"!=this.element.dataset.beckStyle}get totalLength(){return this.element.getTotalLength()}get termini(){const t=this.element.getAttribute("d");return o.SvgUtils.readTermini(t||void 0)}get animOrder(){if(null!=this.element.dataset.animOrder)return l.Rotation.from(this.element.dataset.animOrder)}get speed(){if(null!=this.element.dataset.speed)return parseInt(this.element.dataset.speed)}updateBoundingBox(t){const e=super.boundingBox;this._boundingBox.tl=e.tl,this._boundingBox.br=e.br}get stops(){return 0==this._stops.length&&(this._stops=o.SvgUtils.readStops(this.element.dataset.stops)),this._stops}draw(t,e,i,n,s,a){this.element.style.visibility="hidden",this.createPath(n),this.updateBoundingBox(n);const o=new r.SvgAnimator;o.wait(1e3*t,(()=>{this.element.className.baseVal+=" line "+this.name,this.element.style.visibility="visible",this.updateDasharray(s),0!=a&&this.updateColor(a),0==e&&(s=0);const t=i?-1:1;o.from(s*t).to(0).animate(1e3*e,((t,e)=>this.animateFrame(t,e)))}))}move(t,e,i,n,s,a){this.updateBoundingBox(n);const o=new r.SvgAnimator;o.wait(1e3*t,(()=>{o.animate(1e3*e,((t,e)=>this.animateFrameVector(i,n,s,a,t,e)))}))}erase(t,e,i,n){const s=new r.SvgAnimator;s.wait(1e3*t,(()=>{let t=0;0==e&&(t=n);const r=i?-1:1;s.from(t).to(n*r).animate(1e3*e,((t,e)=>this.animateFrame(t,e)))}))}createPath(t){if(0==t.length)return;const e="M"+t.map((t=>t.x+","+t.y)).join(" L");this.element.setAttribute("d",e)}updateDasharray(t){let e=t+"";if(null==this.element.dataset.dashInitial&&(this.element.dataset.dashInitial=getComputedStyle(this.element).strokeDasharray.replace(/[^0-9\s,]+/g,"")),this.element.dataset.dashInitial.length>0){let i=this.element.dataset.dashInitial.split(/[\s,]+/);i.length%2==1&&(i=i.concat(i));const n=i.map((t=>parseInt(t)||0)).reduce(((t,e)=>t+e),0);e=new Array(Math.ceil(t/n+1)).join(i.join(" ")+" ")+"0"}this.element.style.strokeDasharray=e+" "+t}updateColor(t){this.element.style.stroke="rgb("+256*Math.max(0,t)+", 0, "+-256*Math.min(0,t)+")"}animateFrame(t,e){return this.element.style.strokeDashoffset=t+"",e&&0!=t&&(this.element.style.visibility="hidden"),!0}animateFrameVector(t,e,i,n,s,r){if(r)this.updateDasharray(e[0].delta(e[e.length-1]).length),this.createPath(e);else{const r=[];for(let i=0;i<t.length;i++)r.push(t[i].between(e[i],s));this.updateDasharray(r[0].delta(r[r.length-1]).length),this.createPath(r),this.updateColor((n-i)*s+i)}return!0}}e.SvgLine=h},2234:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgNetwork=void 0;const n=i(19),s=i(7858),r=i(294),a=i(5400),o=i(2203),l=i(3197),h=i(6311),d=i(3737),c=i(5635),u=i(8497),g=i(1761),f=i(4183),m=i(71),p=i(1295),x=i(5656),v=i(1312),w=i(9293),b=i(1449);class y{constructor(){this.currentZoomCenter=s.Vector.NULL,this.currentZoomScale=1,this.parent=null,this.svgConfig()}svgConfig(){const t=document.querySelector("svg");null!=(null==t?void 0:t.dataset.autoStart)&&(v.Config.default.autoStart="false"!=(null==t?void 0:t.dataset.autoStart)),null!=(null==t?void 0:t.dataset.zoomMaxScale)&&(v.Config.default.zoomMaxScale=parseFloat(null==t?void 0:t.dataset.zoomMaxScale)),null!=(null==t?void 0:t.dataset.beckStyle)&&(v.Config.default.beckStyle="false"!=(null==t?void 0:t.dataset.beckStyle)),null!=(null==t?void 0:t.dataset.trainTimetableSpeed)&&(v.Config.default.trainTimetableSpeed=parseFloat(null==t?void 0:t.dataset.trainTimetableSpeed))}get canvasSize(){const t=document.querySelector("svg"),e=null==t?void 0:t.viewBox.baseVal;return e?new n.BoundingBox(new s.Vector(e.x,e.y),new s.Vector(e.x+e.width,e.y+e.height)):new n.BoundingBox(s.Vector.NULL,s.Vector.NULL)}initialize(t){document.getElementById("elements")||console.warn('A group with the id "elements" is missing in the SVG source. It might be needed for helper stations and labels.');let e=document.getElementsByTagName("*");for(let i=0;i<e.length;i++){const n=this.mirrorElement(e[i],t);null!=n&&t.addToIndex(n)}}mirrorElement(t,e){return"path"==t.localName&&null!=t.dataset.line?new a.Line(new o.SvgLine(t),e,v.Config.default):"path"==t.localName&&null!=t.dataset.train?new g.Train(new f.SvgTrain(t),e,v.Config.default):"rect"==t.localName&&null!=t.dataset.station?(this.parent||(this.parent=t.parentElement),new r.Station(new l.SvgStation(t))):"text"!=t.localName||null==t.dataset.station&&null==t.dataset.line?"image"==t.localName&&null!=t.dataset.zoom?new x.KenImage(new p.SvgKenImage(t)):"foreignObject"==t.localName&&null!=t.dataset.crumpledImage?new w.CrumpledImage(new b.SvgCrumpledImage(t)):null!=t.dataset.from||null!=t.dataset.to?new c.GenericTimedDrawable(new u.SvgGenericTimedDrawable(t)):null:new h.Label(new d.SvgLabel(t),e)}createVirtualStop(t,e,i){var n;const s=document.createElementNS(y.SVGNS,"rect");return s.setAttribute("data-station",t),s.setAttribute("data-dir",i.name),this.setCoord(s,e),s.className.baseVal="helper",null===(n=this.parent)||void 0===n||n.appendChild(s),new r.Station(new l.SvgStation(s))}setCoord(t,e){t.setAttribute("x",e.x),t.setAttribute("y",e.y)}drawEpoch(t){const e=new CustomEvent("epoch",{detail:t});let i;document.dispatchEvent(e),null!=document.getElementById("epoch-label")&&(i=document.getElementById("epoch-label"),i.textContent=t)}zoomTo(t,e,i){const n=new m.SvgAnimator,s=i<=v.Config.default.zoomDuration;n.wait(s?0:1e3*v.Config.default.zoomDuration,(()=>{const r=this.currentZoomCenter,a=this.currentZoomScale;n.ease(s?m.SvgAnimator.EASE_CUBIC:m.SvgAnimator.EASE_NONE).animate(1e3*i,((i,n)=>(this.animateFrame(i,n,r,t,a,e),!0))),this.currentZoomCenter=t,this.currentZoomScale=e}))}animateFrame(t,e,i,n,r,a){if(e)this.updateZoom(n,a);else{const e=i.delta(n),o=new s.Vector(e.x*t,e.y*t).add(i),l=(a-r)*t+r;this.updateZoom(o,l)}}updateZoom(t,e){const i=document.getElementById("zoomable");if(null!=i){const n=this.canvasSize.tl.between(this.canvasSize.br,.5);i.style.transformOrigin=n.x+"px "+n.y+"px",i.style.transform="scale("+e+") translate("+(n.x-t.x)+"px,"+(n.y-t.y)+"px)"}}}e.SvgNetwork=y,y.SVGNS="http://www.w3.org/2000/svg"},3351:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgStation=void 0;const n=i(7858),s=i(9591),r=i(71),a=i(6844),o=i(1312);class l extends a.SvgAbstractTimedDrawable{constructor(t){super(t),this.element=t}get id(){if(null!=this.element.dataset.station)return this.element.dataset.station;throw new Error("Station needs to have a data-station identifier")}get baseCoords(){return new n.Vector(parseFloat(this.element.getAttribute("x")||"")||0,parseFloat(this.element.getAttribute("y")||"")||0)}set baseCoords(t){this.element.setAttribute("x",t.x+""),this.element.setAttribute("y",t.y+"")}get lonLat(){var t;const e=null===(t=this.element.dataset.lonLat)||void 0===t?void 0:t.split(" ");if(null!=e)return new n.Vector(parseFloat(e[0]),parseFloat(e[1]))}get rotation(){return s.Rotation.from(this.element.dataset.dir||"n")}get labelDir(){return s.Rotation.from(this.element.dataset.labelDir||"n")}draw(t,e,i){(new r.SvgAnimator).wait(1e3*t,(()=>{const t=i(),n=[t.x[1]-t.x[0],t.y[1]-t.y[0]];this.element.className.baseVal.includes("station")||(this.element.className.baseVal+=" station "+this.id),n[0]<0&&n[1]<0?this.hide(e):this.show(e),this.element.setAttribute("width",Math.max(n[0],0)*o.Config.default.lineDistance+o.Config.default.defaultStationDimen+""),this.element.setAttribute("height",Math.max(n[1],0)*o.Config.default.lineDistance+o.Config.default.defaultStationDimen+""),this.updateTransformOrigin();const s=Math.min(t.x[0],0)*o.Config.default.lineDistance-o.Config.default.defaultStationDimen/2,r=Math.min(t.y[0],0)*o.Config.default.lineDistance-o.Config.default.defaultStationDimen/2;this.element.setAttribute("transform","rotate("+this.rotation.degrees+") translate("+s+","+r+")")}))}updateTransformOrigin(){this.element.setAttribute("transform-origin",this.baseCoords.x+" "+this.baseCoords.y)}move(t,e,i,n,s){const a=new r.SvgAnimator;a.wait(1e3*t,(()=>{a.animate(1e3*e,((t,e)=>this.animateFrameVector(t,e,i,n,s)))}))}animateFrameVector(t,e,i,n,s){return this.baseCoords=e?n:i.between(n,t),this.updateTransformOrigin(),s(),!0}erase(t,e){(new r.SvgAnimator).wait(1e3*t,(()=>{this.hide(1e3*e)}))}}e.SvgStation=l},4536:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgTrain=void 0;const n=i(7858),s=i(19),r=i(9591),a=i(71),o=i(6844),l=i(300),h=i(1312);class d extends o.SvgAbstractTimedDrawable{constructor(t){super(t),this.element=t,this._stops=[]}get name(){return this.element.dataset.train||""}get boundingBox(){return new s.BoundingBox(n.Vector.NULL,n.Vector.NULL)}get length(){return null==this.element.dataset.length?2:parseInt(this.element.dataset.length)}get stops(){return 0==this._stops.length&&(this._stops=l.SvgUtils.readStops(this.element.dataset.stops)),this._stops}draw(t,e,i){if(this.element.className.baseVal+=" train",this.setPath(this.calcTrainHinges(this.getPathLength(i).lengthToStart,i.path)),!this.from.flag.includes("autoshow")){(new a.SvgAnimator).wait(1e3*t,(()=>{this.show(e)}))}}move(t,e,i){const n=new a.SvgAnimator;n.wait(1e3*t,(()=>{this.show(0!=e?h.Config.default.fadeDurationSeconds:0);const s=this.getPathLength(i);n.ease(a.SvgAnimator.EASE_SINE).from(s.lengthToStart).to(s.lengthToStart+s.totalBoundedLength).timePassed(t<0?1e3*-t:0).animate(1e3*e,((t,n)=>this.animateFrame(t,n,i.path,e)))}))}getPathLength(t){let e=0,i=0;for(let n=0;n<t.path.length-1;n++){const s=t.path[n].delta(t.path[n+1]).length;n<t.from?e+=s:n<t.to&&(i+=s)}return{lengthToStart:e,totalBoundedLength:i}}getPositionByLength(t,e){let i=0;for(let n=0;n<e.length-1;n++){const s=e[n].delta(e[n+1]),a=s.length;if(i+a>=t)return e[n].between(e[n+1],(t-i)/a).add(s.rotate(new r.Rotation(90)).withLength(h.Config.default.trainTrackOffset));i+=a}return e[e.length-1]}erase(t,e){(new a.SvgAnimator).wait(1e3*t,(()=>{this.hide(e)}))}setPath(t){const e="M"+t.map((t=>t.x+","+t.y)).join(" L");this.element.setAttribute("d",e)}calcTrainHinges(t,e){const i=[];for(let n=0;n<this.length+1;n++)i.push(this.getPositionByLength(t-n*h.Config.default.trainWagonLength,e));return i}animateFrame(t,e,i,n){const s=this.calcTrainHinges(t,i);return this.setPath(s),e&&this.from.flag.includes("autoshow")&&this.hide(0!=n?h.Config.default.fadeDurationSeconds:0),!0}}e.SvgTrain=d},490:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SvgUtils=void 0;const n=i(294),s=i(7858);e.SvgUtils=class{static readStops(t){const e=[],i=(null==t?void 0:t.split(/\s+/))||[];let s=new n.Stop("","");for(var r=0;r<(null==i?void 0:i.length);r++)"-"!=i[r][0]&&"+"!=i[r][0]&&"*"!=i[r][0]?(s.stationId=i[r],e.push(s),s=new n.Stop("","")):s.trackInfo=i[r];return e}static readTermini(t){const e=null==t?void 0:t.trim().split(/[^\d.]+/);return null!=e?[new s.Vector(parseFloat(e[1]),parseFloat(e[2])),new s.Vector(parseFloat(e[e.length-2]),parseFloat(e[e.length-1]))]:[]}}},5246:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>f});const n=134217729;function s(t,e,i,n,s){let r,a,o,l,h=e[0],d=n[0],c=0,u=0;d>h==d>-h?(r=h,h=e[++c]):(r=d,d=n[++u]);let g=0;if(c<t&&u<i)for(d>h==d>-h?(a=h+r,o=r-(a-h),h=e[++c]):(a=d+r,o=r-(a-d),d=n[++u]),r=a,0!==o&&(s[g++]=o);c<t&&u<i;)d>h==d>-h?(a=r+h,l=a-r,o=r-(a-l)+(h-l),h=e[++c]):(a=r+d,l=a-r,o=r-(a-l)+(d-l),d=n[++u]),r=a,0!==o&&(s[g++]=o);for(;c<t;)a=r+h,l=a-r,o=r-(a-l)+(h-l),h=e[++c],r=a,0!==o&&(s[g++]=o);for(;u<i;)a=r+d,l=a-r,o=r-(a-l)+(d-l),d=n[++u],r=a,0!==o&&(s[g++]=o);return 0===r&&0!==g||(s[g++]=r),g}function r(t){return new Float64Array(t)}const a=r(4),o=r(8),l=r(12),h=r(16),d=r(4);function c(t,e,i,r,c,u){const g=(e-u)*(i-c),f=(t-c)*(r-u),m=g-f;if(0===g||0===f||g>0!=f>0)return m;const p=Math.abs(g+f);return Math.abs(m)>=33306690738754716e-32*p?m:-function(t,e,i,r,c,u,g){let f,m,p,x,v,w,b,y,S,_,I,C,B,A,T,L,D,M;const N=t-c,P=i-c,E=e-u,V=r-u;A=N*V,w=n*N,b=w-(w-N),y=N-b,w=n*V,S=w-(w-V),_=V-S,T=y*_-(A-b*S-y*S-b*_),L=E*P,w=n*E,b=w-(w-E),y=E-b,w=n*P,S=w-(w-P),_=P-S,D=y*_-(L-b*S-y*S-b*_),I=T-D,v=T-I,a[0]=T-(I+v)+(v-D),C=A+I,v=C-A,B=A-(C-v)+(I-v),I=B-L,v=B-I,a[1]=B-(I+v)+(v-L),M=C+I,v=M-C,a[2]=C-(M-v)+(I-v),a[3]=M;let O=function(t,e){let i=e[0];for(let n=1;n<t;n++)i+=e[n];return i}(4,a),j=22204460492503146e-32*g;if(O>=j||-O>=j)return O;if(v=t-N,f=t-(N+v)+(v-c),v=i-P,p=i-(P+v)+(v-c),v=e-E,m=e-(E+v)+(v-u),v=r-V,x=r-(V+v)+(v-u),0===f&&0===m&&0===p&&0===x)return O;if(j=11093356479670487e-47*g+33306690738754706e-32*Math.abs(O),O+=N*x+V*f-(E*p+P*m),O>=j||-O>=j)return O;A=f*V,w=n*f,b=w-(w-f),y=f-b,w=n*V,S=w-(w-V),_=V-S,T=y*_-(A-b*S-y*S-b*_),L=m*P,w=n*m,b=w-(w-m),y=m-b,w=n*P,S=w-(w-P),_=P-S,D=y*_-(L-b*S-y*S-b*_),I=T-D,v=T-I,d[0]=T-(I+v)+(v-D),C=A+I,v=C-A,B=A-(C-v)+(I-v),I=B-L,v=B-I,d[1]=B-(I+v)+(v-L),M=C+I,v=M-C,d[2]=C-(M-v)+(I-v),d[3]=M;const k=s(4,a,4,d,o);A=N*x,w=n*N,b=w-(w-N),y=N-b,w=n*x,S=w-(w-x),_=x-S,T=y*_-(A-b*S-y*S-b*_),L=E*p,w=n*E,b=w-(w-E),y=E-b,w=n*p,S=w-(w-p),_=p-S,D=y*_-(L-b*S-y*S-b*_),I=T-D,v=T-I,d[0]=T-(I+v)+(v-D),C=A+I,v=C-A,B=A-(C-v)+(I-v),I=B-L,v=B-I,d[1]=B-(I+v)+(v-L),M=C+I,v=M-C,d[2]=C-(M-v)+(I-v),d[3]=M;const z=s(k,o,4,d,l);A=f*x,w=n*f,b=w-(w-f),y=f-b,w=n*x,S=w-(w-x),_=x-S,T=y*_-(A-b*S-y*S-b*_),L=m*p,w=n*m,b=w-(w-m),y=m-b,w=n*p,S=w-(w-p),_=p-S,D=y*_-(L-b*S-y*S-b*_),I=T-D,v=T-I,d[0]=T-(I+v)+(v-D),C=A+I,v=C-A,B=A-(C-v)+(I-v),I=B-L,v=B-I,d[1]=B-(I+v)+(v-L),M=C+I,v=M-C,d[2]=C-(M-v)+(I-v),d[3]=M;const U=s(z,l,4,d,h);return h[U-1]}(t,e,i,r,c,u,p)}r(4),r(4),r(4),r(4),r(4),r(4),r(4),r(4),r(4),r(8),r(8),r(8),r(4),r(8),r(8),r(8),r(12);r(192),r(192);r(4),r(4),r(4),r(4),r(4),r(4),r(4),r(4),r(8),r(8),r(8),r(8),r(8),r(8),r(8),r(8),r(8),r(4),r(4),r(4),r(8),r(16),r(16),r(16),r(32),r(32),r(48),r(64);r(1152),r(1152);r(4),r(4),r(4),r(4),r(4),r(4),r(4),r(4),r(4),r(4),r(24),r(24),r(24),r(24),r(24),r(24),r(24),r(24),r(24),r(24),r(1152),r(1152),r(1152),r(1152),r(1152),r(2304),r(2304),r(3456),r(5760),r(8),r(8),r(8),r(16),r(24),r(48),r(48),r(96),r(192),r(384),r(384),r(384),r(768);r(96),r(96),r(96),r(1152);const u=Math.pow(2,-52),g=new Uint32Array(512);class f{static from(t,e=b,i=y){const n=t.length,s=new Float64Array(2*n);for(let r=0;r<n;r++){const n=t[r];s[2*r]=e(n),s[2*r+1]=i(n)}return new f(s)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*i),this._halfedges=new Int32Array(3*i),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:i,_hullTri:n,_hullHash:s}=this,r=t.length>>1;let a=1/0,o=1/0,l=-1/0,h=-1/0;for(let e=0;e<r;e++){const i=t[2*e],n=t[2*e+1];i<a&&(a=i),n<o&&(o=n),i>l&&(l=i),n>h&&(h=n),this._ids[e]=e}const d=(a+l)/2,g=(o+h)/2;let f,p,w,b=1/0;for(let e=0;e<r;e++){const i=m(d,g,t[2*e],t[2*e+1]);i<b&&(f=e,b=i)}const y=t[2*f],S=t[2*f+1];b=1/0;for(let e=0;e<r;e++){if(e===f)continue;const i=m(y,S,t[2*e],t[2*e+1]);i<b&&i>0&&(p=e,b=i)}let _=t[2*p],I=t[2*p+1],C=1/0;for(let e=0;e<r;e++){if(e===f||e===p)continue;const i=x(y,S,_,I,t[2*e],t[2*e+1]);i<C&&(w=e,C=i)}let B=t[2*w],A=t[2*w+1];if(C===1/0){for(let e=0;e<r;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];v(this._ids,this._dists,0,r-1);const e=new Uint32Array(r);let i=0;for(let t=0,n=-1/0;t<r;t++){const s=this._ids[t];this._dists[s]>n&&(e[i++]=s,n=this._dists[s])}return this.hull=e.subarray(0,i),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(c(y,S,_,I,B,A)<0){const t=p,e=_,i=I;p=w,_=B,I=A,w=t,B=e,A=i}const T=function(t,e,i,n,s,r){const a=i-t,o=n-e,l=s-t,h=r-e,d=a*a+o*o,c=l*l+h*h,u=.5/(a*h-o*l);return{x:t+(h*d-o*c)*u,y:e+(a*c-l*d)*u}}(y,S,_,I,B,A);this._cx=T.x,this._cy=T.y;for(let e=0;e<r;e++)this._dists[e]=m(t[2*e],t[2*e+1],T.x,T.y);v(this._ids,this._dists,0,r-1),this._hullStart=f;let L=3;i[f]=e[w]=p,i[p]=e[f]=w,i[w]=e[p]=f,n[f]=0,n[p]=1,n[w]=2,s.fill(-1),s[this._hashKey(y,S)]=f,s[this._hashKey(_,I)]=p,s[this._hashKey(B,A)]=w,this.trianglesLen=0,this._addTriangle(f,p,w,-1,-1,-1);for(let r,a,o=0;o<this._ids.length;o++){const l=this._ids[o],h=t[2*l],d=t[2*l+1];if(o>0&&Math.abs(h-r)<=u&&Math.abs(d-a)<=u)continue;if(r=h,a=d,l===f||l===p||l===w)continue;let g=0;for(let t=0,e=this._hashKey(h,d);t<this._hashSize&&(g=s[(e+t)%this._hashSize],-1===g||g===i[g]);t++);g=e[g];let m,x=g;for(;m=i[x],c(h,d,t[2*x],t[2*x+1],t[2*m],t[2*m+1])>=0;)if(x=m,x===g){x=-1;break}if(-1===x)continue;let v=this._addTriangle(x,l,i[x],-1,-1,n[x]);n[l]=this._legalize(v+2),n[x]=v,L++;let b=i[x];for(;m=i[b],c(h,d,t[2*b],t[2*b+1],t[2*m],t[2*m+1])<0;)v=this._addTriangle(b,l,m,n[l],-1,n[b]),n[l]=this._legalize(v+2),i[b]=b,L--,b=m;if(x===g)for(;m=e[x],c(h,d,t[2*m],t[2*m+1],t[2*x],t[2*x+1])<0;)v=this._addTriangle(m,l,x,-1,n[x],n[m]),this._legalize(v+2),n[m]=v,i[x]=x,L--,x=m;this._hullStart=e[l]=x,i[x]=e[b]=l,i[l]=b,s[this._hashKey(h,d)]=l,s[this._hashKey(t[2*x],t[2*x+1])]=x}this.hull=new Uint32Array(L);for(let t=0,e=this._hullStart;t<L;t++)this.hull[t]=e,e=i[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const i=t/(Math.abs(t)+Math.abs(e));return(e>0?3-i:1+i)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:i,coords:n}=this;let s=0,r=0;for(;;){const a=i[t],o=t-t%3;if(r=o+(t+2)%3,-1===a){if(0===s)break;t=g[--s];continue}const l=a-a%3,h=o+(t+1)%3,d=l+(a+2)%3,c=e[r],u=e[t],f=e[h],m=e[d];if(p(n[2*c],n[2*c+1],n[2*u],n[2*u+1],n[2*f],n[2*f+1],n[2*m],n[2*m+1])){e[t]=m,e[a]=c;const n=i[d];if(-1===n){let e=this._hullStart;do{if(this._hullTri[e]===d){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,n),this._link(a,i[r]),this._link(r,d);const o=l+(a+1)%3;s<g.length&&(g[s++]=o)}else{if(0===s)break;t=g[--s]}}return r}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,i,n,s,r){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=e,this._triangles[a+2]=i,this._link(a,n),this._link(a+1,s),this._link(a+2,r),this.trianglesLen+=3,a}}function m(t,e,i,n){const s=t-i,r=e-n;return s*s+r*r}function p(t,e,i,n,s,r,a,o){const l=t-a,h=e-o,d=i-a,c=n-o,u=s-a,g=r-o,f=d*d+c*c,m=u*u+g*g;return l*(c*m-f*g)-h*(d*m-f*u)+(l*l+h*h)*(d*g-c*u)<0}function x(t,e,i,n,s,r){const a=i-t,o=n-e,l=s-t,h=r-e,d=a*a+o*o,c=l*l+h*h,u=.5/(a*h-o*l),g=(h*d-o*c)*u,f=(a*c-l*d)*u;return g*g+f*f}function v(t,e,i,n){if(n-i<=20)for(let s=i+1;s<=n;s++){const n=t[s],r=e[n];let a=s-1;for(;a>=i&&e[t[a]]>r;)t[a+1]=t[a--];t[a+1]=n}else{let s=i+1,r=n;w(t,i+n>>1,s),e[t[i]]>e[t[n]]&&w(t,i,n),e[t[s]]>e[t[n]]&&w(t,s,n),e[t[i]]>e[t[s]]&&w(t,i,s);const a=t[s],o=e[a];for(;;){do{s++}while(e[t[s]]<o);do{r--}while(e[t[r]]>o);if(r<s)break;w(t,s,r)}t[i+1]=t[r],t[r]=a,n-s+1>=r-i?(v(t,e,s,n),v(t,e,i,r-1)):(v(t,e,i,r-1),v(t,e,s,n))}}function w(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function b(t){return t[0]}function y(t){return t[1]}}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,i),r.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};i(7014)})();